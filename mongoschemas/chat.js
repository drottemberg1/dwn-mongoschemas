"use strict";
const mongoose=require("mongoose");

const uuid=require("node-uuid");
module.exports=new mongoose.Schema({
	_id:{
		type:String,
		default:uuid.v1
	},
	users:[
		{
			type:String,
			ref:'users'
		}
	],
	messages:[
		{
			_id:{
				type:String,
				required:true
			},
			user:{
				type:String,
				ref:'users',
				required:true
			},
			date:{
				type:Date,
				required:true
			},
			body:{
				type:String,
				required:true
			},
			visibleTo:[
				{
					type:String,
					ref:'users'
				}
			],
			viewedBy:[
				{
					type:String,
					ref:'users'
				}
			]
		}
	],
	originalUsers:[
		{
			type:String,
			ref:'users'
		}
	],
	deleted:{
		type:Boolean
	},
	isGroup:{
		type:Boolean
	},
	deletionDate:{
		type:Date
	}
},{bufferCommands:false,collection:"chats",timestamps:true,versionKey:false,_id:false,id:false}).index({users:1,messages:1});
